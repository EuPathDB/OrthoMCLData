#!/usr/bin/perl
 
use strict;

usage() unless scalar(@ARGV) == 4;

my ($inputTabFile, $outputFastaFile, $outputAliasesFile) = @ARGV;

open(FASTA, ">$outputFastaFile") || die "Can't open '$outputFastaFile' for writing\n";
open(ALIASES, ">$outputAliasesFile") || die "Can't open '$outputAliasesFile' for writing\n";
open(TAB, "$inputTabFile") || die "Can't open '$inputTabFile' for reading\n";

my %geneIds;
while(<TAB>) {
    chomp;
    my ($geneId, $repGeneId, $transcriptId, $seq, $product, $organism) = split("\t");
    print FASTA ">$geneId $product\n$seq\n";
    print ALIASES "$repGeneId\t$geneId\t$organism\n" unless $geneIds{$geneId};;
    print ALIASES "$repGeneId\t$transcriptId\t\n";  # empty remark column
    $geneIds{$geneId} = 1;
}

sub usage {

die "
Unpack a uniprot fasta file to produce a file of aliases   

Usage: orthomclUnpackEupathProteins input_fasta_file output_aliases_file

Where: 
  input_fasta_file:    a uniprot fasta file.  the defline has 
  output_aliases_file: a mapping between the representative gene and gene_ids and transcript_ids of the represented genes.  Two columns:  rep_gene_id,alias_id.  If the alias is a gene, a third column specifies its organism (to be loaded into Remark column)

";
}
