#!/usr/bin/perl
 
use strict;

usage() unless scalar(@ARGV) == 2;

my ($inputTabFile, $outputFastaFile) = @ARGV;

open(FASTA, ">$outputFastaFile") || die "Can't open '$outputFastaFile' for writing\n";
open(TAB, "$inputTabFile") || die "Can't open '$inputTabFile' for reading\n";

while(<TAB>) {
    chomp;
    my ($geneId, $repGeneId, $transcriptId, $seq, $product, $organism) = split("\t");
    print FASTA ">$geneId|$transcriptId $product\n$seq\n" if $geneId eq $repGeneId;
}

sub usage {

die "
Unpack a tab file that contains info about EupathDB proteins. Include in the output fasta only transcripts from the representative gene.  

Usage: orthomclUnpackEupathProteins input_tab_file output_fasta_file 

Where: 
  input_tab_file:      gene_id, representative_gene_id, transcript_id, protein_seq, product
  output_fasta_file:   fasta file as expected by orthomcl workflow
";
}
